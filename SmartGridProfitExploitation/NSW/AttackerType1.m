yalmip('clear')
clear all;
opts = sdpsettings('verbose', 1, 'solver', 'fmincon');   %solver %
format long

fr=[];
Profit=[];

% Define the data with 1000 elements (as an example, you can replace these arrays with your actual data)
ScheduledGenerationMW_Actual = [6286.74787000000,6186.49970000000,6176.36266000000,6130.40638000000,6093.74971000000,6182.84484000000,6102.82794000000,6156.30505000000,6209.08031000000,6239.95113000000,6251.46658000000,6217.22603000000,6178.58391000000,6079.63105000000,6046.09630000000,6078.92309000000,6116.77451000000,6183.38513000000,6172.37672000000,6093.93156000000,6093.76542000000,6062.30080000000,6042.42076000000,6047.39943000000,6042.42567000000,6039.26532000000,6049.46870000000,5963.91861000000,5910.50027000000,5809.31422000000,5860.26976000000,5812.47134000000,5790.28289000000,5832.83055000000,5777.63669000000,5668.89291000000,5679.86158000000,5611.58240000000,5551.50223000000,5624.34894000000,5611.63316000000,5543.95518000000,5499.94913000000,5378.85292000000,5499.19375000000,5613.05859000000,5514.25652000000,5595.77990000000,5719.56477000000,5664.74063000000,5652.70342000000,5594.90977000000,5625.89616000000,5616.18673000000,5616.65844000000,5571.30237000000,5547.86560000000,5512.29231000000,5533.23955000000,5590.80016000000,5646.23047000000,5689.92044000000,5760.07733000000,5852.92664000000,5857.43458000000,6088.56375000000,5990.08619000000,6081.21645000000,6167.84061000000,6162.46407000000,6129.97433000000,6155.94449000000,6144.39447000000,6036.21227000000,5969.35586000000,6010.41372000000,6010.31119000000,6010.43377000000,5972.28981000000,5993.90643000000,6006.28452000000,6037.42205000000,6007.33622000000,6027.37841000000,5995.43567000000,5945.68886000000,5908.43130000000,5887.46529000000,5735.36197000000,5569.02736000000,5414.16578000000,5248.77027000000,5056.36494000000,4866.39057000000,4727.18523000000,4667.42123000000,4494.58816000000,4321.22186000000,4437.31894000000,4206.49491000000,4127.13094000000,4026.50404000000,4030.56671000000,3949.90341000000,3823.86086000000,3760.58788000000,3637.15633000000,3587.04016000000,3500.85452000000,3433.08015000000,3313.96877000000,3237.91359000000,3179.50275000000,3126.81258000000,3088.27098000000,3014.71918000000,2926.41071000000,2842.40811000000,2723.64872000000,2664.03443000000,2580.82925000000,2489.19286000000,2482.64486000000,2485.77164000000,2483.00114000000,2482.99827000000,2520.83482000000,2532.58016000000,2683.03861000000,2737.51478000000,2775.48793000000,2707.20925000000,2626.48049000000,2564.18390000000,2508.13505000000,2487.77454000000,2454.01104000000,2435.73637000000,2415.59061000000,2400.25711000000,2393.00005000000,2392.99551000000,2366.69722000000,2392.99742000000,2391.99532000000];


SemiScheduledGenerationMW_Actual = [1192.37213000000,1231.18030000000,1226.34734000000,1235.42362000000,1236.89029000000,1267.34516000000,1285.77206000000,1242.80495000000,1239.62969000000,1254.36887000000,1310.12342000000,1399.37397000000,1452.53609000000,1471.04895000000,1492.32370000000,1401.13691000000,1234.67549000000,1104.25487000000,1111.04328000000,1126.63844000000,1141.47458000000,1099.54920000000,1073.32924000000,1047.54057000000,1017.50433000000,1033.64468000000,1051.95130000000,1077.87139000000,1135.71973000000,1175.47578000000,1210.39024000000,1253.68866000000,1264.66711000000,1242.11945000000,1225.11331000000,1239.02709000000,1274.26842000000,1306.46760000000,1335.82777000000,1329.41106000000,1341.87684000000,1424.66482000000,1384.32087000000,1388.97708000000,1404.88625000000,1328.78141000000,1368.84348000000,1261.99010000000,1212.34523000000,1185.92937000000,1125.18658000000,1088.20023000000,1046.48384000000,1009.91327000000,1022.26156000000,1030.85763000000,1052.22440000000,1072.63769000000,1105.45045000000,1071.14984000000,1063.64953000000,1043.18956000000,1032.56267000000,992.743360000000,988.805420000000,985.476250000000,1005.19381000000,1023.63355000000,1023.10939000000,1011.91593000000,1031.59567000000,1063.12551000000,1102.57553000000,1127.73773000000,1154.49414000000,1169.55628000000,1202.39881000000,1191.23623000000,1171.57019000000,1192.02357000000,1196.77548000000,1215.88795000000,1235.40378000000,1248.25159000000,1234.01433000000,1296.19114000000,1365.87870000000,1368.95471000000,1435.60803000000,1537.28264000000,1496.86422000000,1717.79973000000,1867.30506000000,2026.95943000000,2103.09477000000,2044.51877000000,2293.19184000000,2504.96814000000,2524.38106000000,2621.23509000000,2688.85906000000,2672.27596000000,2416.43329000000,2373.58659000000,2481.53914000000,2566.58212000000,2663.49367000000,2551.35984000000,2630.40548000000,2689.51985000000,2704.10123000000,2844.67641000000,2762.18725000000,2711.82742000000,2644.56902000000,2652.48082000000,2659.31929000000,2685.47189000000,2574.25128000000,2552.93557000000,2654.20075000000,3059.71714000000,3094.77514000000,2919.58836000000,2969.49886000000,2994.47173000000,3220.44518000000,3222.29984000000,3340.74139000000,3347.01522000000,3346.98207000000,3461.70075000000,3042.17951000000,3071.10610000000,2985.99495000000,3034.69546000000,2956.39896000000,2911.88363000000,2912.87939000000,2925.71289000000,3043.28995000000,3285.33449000000,3315.85278000000,3349.38258000000,3309.23468000000];


ScheduledDemandMW_Actual = [7738.13000000000,7721.44000000000,7643.08000000000,7562.50000000000,7534.37000000000,7550.19000000000,7535.63000000000,7450.44000000000,7505.03000000000,7558.66000000000,7596.05000000000,7585.40000000000,7544.89000000000,7476.55000000000,7400.95000000000,7429.36000000000,7341.41000000000,7306.66000000000,7269.31000000000,7186.20000000000,7315.17000000000,7283.65000000000,7173.46000000000,7108.34000000000,7059.23000000000,7045.88000000000,7089.44000000000,6982.09000000000,6944.19000000000,6896.04000000000,6937.70000000000,6902.77000000000,6799.89000000000,6835.31000000000,6799.43000000000,6772.42000000000,6722.13000000000,6733.93000000000,6741.81000000000,6723.01000000000,6682.34000000000,6665.03000000000,6542.52000000000,6593.49000000000,6682.61000000000,6585.29000000000,6593.01000000000,6587.19000000000,6622.63000000000,6656.78000000000,6570.76000000000,6541.65000000000,6546.59000000000,6538.31000000000,6604.08000000000,6640.13000000000,6644,6602.03000000000,6677.01000000000,6627.27000000000,6678.03000000000,6606.29000000000,6730.10000000000,6634.72000000000,6592.59000000000,6739.51000000000,6662.34000000000,6721.39000000000,6816.50000000000,6867.81000000000,6811.64000000000,6884.56000000000,6898.73000000000,6909.71000000000,6942.16000000000,6989.20000000000,7044.43000000000,7078.19000000000,7164.03000000000,7183.98000000000,7272.77000000000,7306.07000000000,7317.53000000000,7308.26000000000,7344.27000000000,7408.91000000000,7411.27000000000,7448.97000000000,7433.48000000000,7369.82000000000,7339.04000000000,7334.02000000000,7320.48000000000,7217.11000000000,7172.26000000000,7150,7157.19000000000,7032.87000000000,7114.28000000000,6956.76000000000,6967.99000000000,6869.16000000000,6845.65000000000,6680.48000000000,6618.35000000000,6487.59000000000,6476.37000000000,6400.22000000000,6372.10000000000,6370.95000000000,6316.07000000000,6411.45000000000,6332.52000000000,6242.60000000000,6181.15000000000,6049.05000000000,6042,5965.62000000000,5780.66000000000,5739.32000000000,5753.30000000000,5720.62000000000,5769.53000000000,5871.56000000000,5784.80000000000,5778.42000000000,5740.21000000000,5849.37000000000,6190.27000000000,6262.80000000000,6226.63000000000,6298.90000000000,6196.39000000000,6078.82000000000,5945.25000000000,5957.27000000000,5823.52000000000,5740.38000000000,5712.83000000000,5686.64000000000,5761.94000000000,5966.09000000000,5992.73000000000,6099.16000000000,6123.67000000000];


ScheduleGenerationMW_Forecast_N = [6642.26000000000,6642.26000000000,6642.26000000000,6642.26000000000,6642.26000000000,6642.26000000000,6425.93900000000,6425.93900000000,6425.93900000000,6425.93900000000,6425.93900000000,6425.93900000000,6152.00400000000,6152.00400000000,6152.00400000000,6152.00400000000,6152.00400000000,6152.00400000000,5975.84400000000,5975.84400000000,5975.84400000000,5975.84400000000,5975.84400000000,5975.84400000000,5784.76800000000,5784.76800000000,5784.76800000000,5784.76800000000,5784.76800000000,5784.76800000000,5534.20500000000,5534.20500000000,5534.20500000000,5534.20500000000,5534.20500000000,5534.20500000000,5312.77700000000,5312.77700000000,5312.77700000000,5312.77700000000,5312.77700000000,5312.77700000000,5144.97900000000,5144.97900000000,5144.97900000000,5144.97900000000,5144.97900000000,5144.97900000000,5040.60100000000,5040.60100000000,5040.60100000000,5040.60100000000,5040.60100000000,5040.60100000000,4867.30400000000,4867.30400000000,4867.30400000000,4867.30400000000,4867.30400000000,4867.30400000000,4894.31200000000,4894.31200000000,4894.31200000000,4894.31200000000,4894.31200000000,4894.31200000000,5083.56900000000,5083.56900000000,5083.56900000000,5083.56900000000,5083.56900000000,5083.56900000000,5260.36800000000,5260.36800000000,5260.36800000000,5260.36800000000,5260.36800000000,5260.36800000000,5757.64500000000,5757.64500000000,5757.64500000000,5757.64500000000,5757.64500000000,5757.64500000000,5936.88200000000,5936.88200000000,5936.88200000000,5936.88200000000,5936.88200000000,5936.88200000000,5499.20600000000,5499.20600000000,5499.20600000000,5499.20600000000,5499.20600000000,5499.20600000000,4808.18700000000,4808.18700000000,4808.18700000000,4808.18700000000,4808.18700000000,4808.18700000000,4108.11884000000,4108.11884000000,4108.11884000000,4108.11884000000,4108.11884000000,4108.11884000000,3777.77051000000,3777.77051000000,3777.77051000000,3777.77051000000,3777.77051000000,3777.77051000000,3387.76571000000,3387.76571000000,3387.76571000000,3387.76571000000,3387.76571000000,3387.76571000000,2774.04625000000,2774.04625000000,2774.04625000000,2774.04625000000,2774.04625000000,2774.04625000000,2581.00098000000,2581.00098000000,2581.00098000000,2581.00098000000,2581.00098000000,2581.00098000000,2580.99576000000,2580.99576000000,2580.99576000000,2580.99576000000,2580.99576000000,2580.99576000000,2581.00069000000,2581.00069000000,2581.00069000000,2581.00069000000,2581.00069000000,2581.00069000000,2580.99856000000];


SemiScheduleGenerationMW_Forecast_N = [1006.70000000000,1006.70000000000,1006.70000000000,1006.70000000000,1006.70000000000,1006.70000000000,1058.81100000000,1058.81100000000,1058.81100000000,1058.81100000000,1058.81100000000,1058.81100000000,1103.22600000000,1103.22600000000,1103.22600000000,1103.22600000000,1103.22600000000,1103.22600000000,1158.18600000000,1158.18600000000,1158.18600000000,1158.18600000000,1158.18600000000,1158.18600000000,1204.76200000000,1204.76200000000,1204.76200000000,1204.76200000000,1204.76200000000,1204.76200000000,1251.55500000000,1251.55500000000,1251.55500000000,1251.55500000000,1251.55500000000,1251.55500000000,1290.78300000000,1290.78300000000,1290.78300000000,1290.78300000000,1290.78300000000,1290.78300000000,1318.05100000000,1318.05100000000,1318.05100000000,1318.05100000000,1318.05100000000,1318.05100000000,1350.58900000000,1350.58900000000,1350.58900000000,1350.58900000000,1350.58900000000,1350.58900000000,1341.49600000000,1341.49600000000,1341.49600000000,1341.49600000000,1341.49600000000,1341.49600000000,1337.03800000000,1337.03800000000,1337.03800000000,1337.03800000000,1337.03800000000,1337.03800000000,1331.52100000000,1331.52100000000,1331.52100000000,1331.52100000000,1331.52100000000,1331.52100000000,1325.45200000000,1325.45200000000,1325.45200000000,1325.45200000000,1325.45200000000,1325.45200000000,1309.39500000000,1309.39500000000,1309.39500000000,1309.39500000000,1309.39500000000,1309.39500000000,1316.84800000000,1316.84800000000,1316.84800000000,1316.84800000000,1316.84800000000,1316.84800000000,1630.18400000000,1630.18400000000,1630.18400000000,1630.18400000000,1630.18400000000,1630.18400000000,2173.90300000000,2173.90300000000,2173.90300000000,2173.90300000000,2173.90300000000,2173.90300000000,2670.59116000000,2670.59116000000,2670.59116000000,2670.59116000000,2670.59116000000,2670.59116000000,2979.69949000000,2979.69949000000,2979.69949000000,2979.69949000000,2979.69949000000,2979.69949000000,3070.18429000000,3070.18429000000,3070.18429000000,3070.18429000000,3070.18429000000,3070.18429000000,3282.39375000000,3282.39375000000,3282.39375000000,3282.39375000000,3282.39375000000,3282.39375000000,3105.45902000000,3105.45902000000,3105.45902000000,3105.45902000000,3105.45902000000,3105.45902000000,2970.81424000000,2970.81424000000,2970.81424000000,2970.81424000000,2970.81424000000,2970.81424000000,2950.50931000000,2950.50931000000,2950.50931000000,2950.50931000000,2950.50931000000,2950.50931000000,2821.26144000000];


NetImportMW_Actual = [-245.270000000000,-294.220000000000,-234.040000000000,-189.380000000000,-194.680000000000,-93.2100000000000,-136.350000000000,-39.4100000000000,-39.5100000000000,-45.7300000000000,-22.4900000000000,45.9400000000000,99.2000000000000,93.2900000000000,154.170000000000,69.2000000000000,26.4600000000000,-0.300000000000000,29.1500000000000,53.3900000000000,-53.0600000000000,-98.3000000000000,-35.4500000000000,7.48000000000000,21.4600000000000,53.3700000000000,37.1000000000000,78.7900000000000,121.880000000000,110.360000000000,152.190000000000,183.710000000000,272.040000000000,257.250000000000,219.090000000000,160.400000000000,253.180000000000,210.080000000000,168.490000000000,246.500000000000,290.510000000000,317.120000000000,359.040000000000,199.390000000000,241.400000000000,369.790000000000,306.240000000000,284.940000000000,316.720000000000,201.170000000000,220,164.890000000000,149.130000000000,115.490000000000,54.9700000000000,-19.2600000000000,-28.2900000000000,-4.51000000000000,-28.8300000000000,45.6900000000000,41.3100000000000,145.980000000000,70.6800000000000,218.470000000000,269.400000000000,343.130000000000,344.020000000000,390.620000000000,381.450000000000,311.710000000000,352.800000000000,339.520000000000,350.560000000000,261.570000000000,181.640000000000,195.610000000000,168.890000000000,121.710000000000,-20.2000000000000,3.07000000000000,-69.3700000000000,-53.9900000000000,-74.6000000000000,-33,-112.640000000000,-164.570000000000,-132.200000000000,-185.370000000000,-250.750000000000,-250.360000000000,-406.620000000000,-348.240000000000,-370.700000000000,-301.700000000000,-317.070000000000,-410.100000000000,-329.430000000000,-158.070000000000,-108.100000000000,-80.3000000000000,-105.310000000000,-118.880000000000,-328.750000000000,-283.050000000000,-241.100000000000,-108.620000000000,-119.720000000000,-202.710000000000,-180.910000000000,-183.190000000000,-227.010000000000,-254.410000000000,-315.770000000000,-325.470000000000,-369.410000000000,-307.100000000000,-372.470000000000,-355.600000000000,-384.930000000000,-424.230000000000,-416.680000000000,-102.100000000000,-119.120000000000,-359.830000000000,-233.510000000000,-205.390000000000,62.3400000000000,-34.2500000000000,-102.550000000000,-114.020000000000,-46.5600000000000,-71.0700000000000,-431.490000000000,-345.520000000000,-351.600000000000,-339.350000000000,-317.560000000000,-304.280000000000,-295.730000000000,-276.160000000000,-246.190000000000,-214.040000000000,-242.950000000000,-288.730000000000,-350.120000000000];


NetImportMWForecast_N = [-307.690000000000,-307.690000000000,-307.690000000000,-307.690000000000,-307.690000000000,-307.690000000000,-320.560000000000,-320.560000000000,-320.560000000000,-320.560000000000,-320.560000000000,-320.560000000000,-486.010000000000,-486.010000000000,-486.010000000000,-486.010000000000,-486.010000000000,-486.010000000000,-393.630000000000,-393.630000000000,-393.630000000000,-393.630000000000,-393.630000000000,-393.630000000000,-288.590000000000,-288.590000000000,-288.590000000000,-288.590000000000,-288.590000000000,-288.590000000000,-271.730000000000,-271.730000000000,-271.730000000000,-271.730000000000,-271.730000000000,-271.730000000000,-239.890000000000,-239.890000000000,-239.890000000000,-239.890000000000,-239.890000000000,-239.890000000000,-224.230000000000,-224.230000000000,-224.230000000000,-224.230000000000,-224.230000000000,-224.230000000000,-232.400000000000,-232.400000000000,-232.400000000000,-232.400000000000,-232.400000000000,-232.400000000000,-380.590000000000,-380.590000000000,-380.590000000000,-380.590000000000,-380.590000000000,-380.590000000000,-370.170000000000,-370.170000000000,-370.170000000000,-370.170000000000,-370.170000000000,-370.170000000000,-233.130000000000,-233.130000000000,-233.130000000000,-233.130000000000,-233.130000000000,-233.130000000000,-188.820000000000,-188.820000000000,-188.820000000000,-188.820000000000,-188.820000000000,-188.820000000000,15.3200000000000,15.3200000000000,15.3200000000000,15.3200000000000,15.3200000000000,15.3200000000000,-40.4100000000000,-40.4100000000000,-40.4100000000000,-40.4100000000000,-40.4100000000000,-40.4100000000000,-304.300000000000,-304.300000000000,-304.300000000000,-304.300000000000,-304.300000000000,-304.300000000000,-605.540000000000,-605.540000000000,-605.540000000000,-605.540000000000,-605.540000000000,-605.540000000000,-638.440000000000,-638.440000000000,-638.440000000000,-638.440000000000,-638.440000000000,-638.440000000000,-546.470000000000,-546.470000000000,-546.470000000000,-546.470000000000,-546.470000000000,-546.470000000000,-719.950000000000,-719.950000000000,-719.950000000000,-719.950000000000,-719.950000000000,-719.950000000000,-738.440000000000,-738.440000000000,-738.440000000000,-738.440000000000,-738.440000000000,-738.440000000000,-845.780000000000,-845.780000000000,-845.780000000000,-845.780000000000,-845.780000000000,-845.780000000000,-635.660000000000,-635.660000000000,-635.660000000000,-635.660000000000,-635.660000000000,-635.660000000000,-413.130000000000,-413.130000000000,-413.130000000000,-413.130000000000,-413.130000000000,-413.130000000000,-365.370000000000];


k = 6;
epsilon = 1e-10; % Small value to prevent division by zero
num_iterations = floor(length(ScheduledGenerationMW_Actual) / k); % Number of 6-value windows

% Initialize arrays to store Lambda and b values for all iterations
Lambda_values = zeros(1, num_iterations); % Preallocate for 1000 elements
b_values = zeros(1, num_iterations);      % Preallocate for 1000 elements

% Initialize final objective value
final_objective_value = 0;

for i = 1:num_iterations
    % Extract the current window of 6 values
    ScheduledGenerationMW_Actual_window = ScheduledGenerationMW_Actual((i-1)*k + 1:i*k);
    SemiScheduledGenerationMW_Actual_window = SemiScheduledGenerationMW_Actual((i-1)*k + 1:i*k);
    ScheduledDemandMW_Actual_window = ScheduledDemandMW_Actual((i-1)*k + 1:i*k);
    ScheduleGenerationMW_Forecast_N_window = ScheduleGenerationMW_Forecast_N((i-1)*k + 1:i*k);
    SemiScheduleGenerationMW_Forecast_N_window = SemiScheduleGenerationMW_Forecast_N((i-1)*k + 1:i*k);
    NetImportMW_Actual_window = NetImportMW_Actual((i-1)*k + 1:i*k);
    NetImportMWForecast_N_window = NetImportMWForecast_N((i-1)*k + 1:i*k);
    
    b = sdpvar(1, k, 'full');
    Lambda = sdpvar(1, k, 'full');
    constraints = [];
    objectiveFunction = 0;

    for m = 1:k
        if m == 1
            b(1,1) = 1; % Initial value
            Lambda(1,1) = 103.20626; % Initial value for Lambda
        else
            Lambda(1,m) = Lambda(1,(m-1))*(1- (ScheduledGenerationMW_Actual_window(1,(m-1))+ SemiScheduledGenerationMW_Actual_window(1,(m-1))-ScheduledDemandMW_Actual_window(1,(m-1)))/(ScheduleGenerationMW_Forecast_N_window(1,(m-1))+SemiScheduleGenerationMW_Forecast_N_window(1,(m-1))-ScheduledDemandMW_Actual_window(1,(m-1)))+(b(1,(m-1))*NetImportMW_Actual_window(1,(m-1)))/(NetImportMWForecast_N_window(1,(m-1))));
            constraints = [constraints, ...
                ((ScheduledGenerationMW_Actual_window(1,m) + SemiScheduledGenerationMW_Actual_window(1,m) - ScheduledDemandMW_Actual_window(1,m) + (b(1,m)*NetImportMW_Actual_window(1,m)))) >= -180, ...
                ((ScheduledGenerationMW_Actual_window(1,m) + SemiScheduledGenerationMW_Actual_window(1,m) - ScheduledDemandMW_Actual_window(1,m) + (b(1,m)*NetImportMW_Actual_window(1,m)))) <= 180, ...
                Lambda(1,m)>=-800, ...
                Lambda(1,m)<=400, ...
                b(1,m) >=-2, ...
                b(1,m) <=2];
            objectiveFunction = objectiveFunction + Lambda(1,m)*b(1,m)*(NetImportMW_Actual_window(1,m));
              
        end
       
    end

    optimize(constraints, objectiveFunction, opts);
    
    % Store the computed values of Lambda and b in the arrays
    Lambda_values((i-1)*k + 1:i*k) = value(Lambda);
    b_values((i-1)*k + 1:i*k) = value(b);
    
    final_objective_value = final_objective_value + value(abs(objectiveFunction));
end


for i = 1:length(Lambda_values)
    if Lambda_values(1,i)>=600
        Lambda_values(1,i) =600;
    end
end

for j = 1:144
    if(Lambda_values(1,j)<=-20)
        Lambda_values(1,j)=-20;
    end
    Profit(1,j) = abs(Lambda_values(1,j)*b_values(1,j)*NetImportMW_Actual(1,j));
end


for j = 1:144
    fr(1,j) = 60+(ScheduledGenerationMW_Actual(1,j)+SemiScheduledGenerationMW_Actual(1,j)-ScheduledDemandMW_Actual(1,j)+b_values(1,j)*NetImportMW_Actual(1,j))/1800;
end


final_objective_value
%Lambda_values
%b_values
