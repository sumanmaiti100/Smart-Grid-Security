yalmip('clear')
clear all;
opts = sdpsettings('verbose', 1, 'solver', 'fmincon');   %solver %
format long

fr=[];
Profit=[];

% Define the data with 1000 elements (as an example, you can replace these arrays with your actual data)
ScheduledGenerationMW_Actual = [5703.51798000000,5753.63077000000,5743.96485000000,5702.39283000000,5582.85513000000,5503.53795000000,5445.90613000000,5345.04834000000,5294.49189000000,5277.97740000000,5268.95959000000,5117.38001000000,5128.17202000000,5040.98252000000,5083.15334000000,5075.19687000000,5103.51528000000,5099.76998000000,5061.53526000000,5030.06101000000,5061.07817000000,5048.75341000000,4943.11335000000,4987.93584000000,4954.21446000000,4856.21499000000,4922.49575000000,4938.27572000000,4931.18266000000,4872.54999000000,4860.75512000000,4844.61516000000,4845.38543000000,4823.13022000000,4827.94321000000,4779.67094000000,4752.70620000000,4659.45138000000,4721.57593000000,4751.71486000000,4738.99676000000,4737.83267000000,4737.37121000000,4776.27303000000,4780.81451000000,4832.17307000000,4778.75873000000,4832.48066000000,4896.49359000000,4916.40142000000,4916.24014000000,4813.48428000000,4807.83349000000,4808.17733000000,4891.07202000000,4914.67254000000,4957.46717000000,4981.72361000000,5023.53973000000,5061.01550000000,5067.02017000000,4973.49287000000,5110.01046000000,5055.15404000000,4950.39952000000,5032.05794000000,4996.99847000000,5093.89510000000,5197.95262000000,5180.77920000000,5198.91927000000,5206.99111000000,5244.46019000000,5280.25480000000,5388.58353000000,5390.22767000000,5506.49300000000,5591.87341000000,5653.89788000000,5672.25182000000,5656.97736000000,5711.16541000000,5789.91220000000,5648.19974000000,5610.88546000000,5437.49289000000,5396.52880000000,5341.05716000000,5130.13805000000,5069.58419000000,4963.00934000000,4720.63644000000,4627.40193000000,4395.04751000000,4220.01342000000,4135.27244000000,3993.74217000000,3931.05073000000,3889.41089000000,3861.16899000000,3823.14773000000,3799.89115000000,3786.26848000000,3752.81753000000,3713.81791000000,3683.54880000000,3656.72165000000,3631.40373000000,3624.92683000000,3610.07694000000,3588.19205000000,3574.41089000000,3541.51442000000,3550.81065000000,3557.53007000000,3526.59270000000,3521.11427000000,3518.59157000000,3518.42764000000,3518.63526000000,3517.17365000000,3517.58334000000,3516.91783000000,3517.88331000000,3517.22423000000,3518.70614000000,3519.24293000000,3517.63412000000,3519.59474000000,3518.08160000000,3516.86863000000,3517.87721000000,3517.83424000000,3518.43423000000,3517.63382000000,3518.38472000000,3517.62609000000,3517.06692000000,3517.93411000000,3516.56598000000,3517.77746000000,3518.02858000000,3517.92659000000,3519.95784000000,3517.40576000000];


SemiScheduledGenerationMW_Actual = [67.2220200000000,69.5792300000000,70.9551500000000,72.0971700000000,65.3748700000000,54.9720500000000,50.3738700000000,51.4816600000000,55.4281100000000,57.2726000000000,56.9804100000000,56.6899900000000,59.2279800000000,55.0874800000000,47.1466600000000,47.1031300000000,49.3147200000000,49.3500200000000,51.2547400000000,49.5289900000000,48.6718300000000,47.3565900000000,45.9966500000000,47.5141600000000,48.0055400000000,46.3450100000000,45.6842500000000,45.4942800000000,43.2773400000000,40.3200100000000,41.8248800000000,50.2648400000000,55.7845700000000,63.6997800000000,64.5667900000000,66.8290600000000,74.5838000000000,73.4886200000000,78.5040700000000,82.0851400000000,77.2832400000000,77.9073300000000,75.5687900000000,71.0869700000000,68.8054900000000,68.9069300000000,71.8312700000000,75.3193400000000,74.6464100000000,77.3885800000000,80.1998600000000,83.7757200000000,82.6265100000000,86.0926700000000,85.0479800000000,91.9474600000000,95.2428300000000,101.946390000000,109.020270000000,112.564500000000,112.929830000000,117.727130000000,120.229540000000,122.235960000000,123.270480000000,127.312060000000,127.241530000000,121.054900000000,114.497380000000,110.680800000000,100.370730000000,100.018890000000,97.7198100000000,96.7452000000000,97.3764700000000,99.3223300000000,101.897000000000,107.156590000000,111.032120000000,118.248180000000,128.062640000000,168.204590000000,214.187800000000,266.020260000000,416.774540000000,510.867110000000,637.021200000000,742.842840000000,877.531950000000,983.725810000000,1148.36066000000,1261.83356000000,1374.19807000000,1491.02249000000,1656.93658000000,1776.24756000000,1819.72783000000,1702.06927000000,1913.54911000000,1955.33101000000,1945.74227000000,1891.19885000000,2073.28152000000,2213.94247000000,2221.80209000000,2002.59120000000,1996.39835000000,1988.87627000000,1923.81317000000,1939.56306000000,1969.24795000000,2009.03911000000,1921.34558000000,1872.66935000000,1791.11993000000,1808.91730000000,1843.27573000000,1812.45843000000,1898.66236000000,1876.55474000000,1855.22635000000,1466.09666000000,1580.24217000000,1829.87669000000,1696.86577000000,1744.35386000000,1370.10707000000,1263.37588000000,1354.69526000000,1332.97840000000,1211.90137000000,1228.32279000000,1573.42576000000,1510.85577000000,1606.58618000000,1617.89528000000,1483.22391000000,1530.13308000000,1501.48589000000,1506.70402000000,1435.67254000000,1415.74142000000,1333.27341000000,1332.61216000000,1359.26424000000];


ScheduledDemandMW_Actual = [5873.84000000000,5826.09000000000,5810.95000000000,5823.39000000000,5724.07000000000,5668.58000000000,5643.23000000000,5621.71000000000,5635.87000000000,5627.26000000000,5570.22000000000,5486.81000000000,5505.75000000000,5481.43000000000,5516.14000000000,5486.04000000000,5470.83000000000,5477.18000000000,5419.71000000000,5440.85000000000,5478.49000000000,5408.92000000000,5333.12000000000,5388.67000000000,5364.17000000000,5334.82000000000,5376.98000000000,5358.62000000000,5380.24000000000,5333.61000000000,5321.50000000000,5338.25000000000,5355.38000000000,5340.40000000000,5311.43000000000,5324.27000000000,5317.02000000000,5247.14000000000,5264.67000000000,5265.69000000000,5305.94000000000,5255.60000000000,5312.35000000000,5343.55000000000,5322.64000000000,5357.63000000000,5315.76000000000,5341.91000000000,5330.42000000000,5297.81000000000,5380.72000000000,5361.47000000000,5348.80000000000,5368.11000000000,5345.22000000000,5315.22000000000,5322.02000000000,5334.41000000000,5323.21000000000,5431.83000000000,5413.44000000000,5493.94000000000,5462.13000000000,5482.70000000000,5505.42000000000,5528.60000000000,5531.50000000000,5578.18000000000,5662,5590.20000000000,5569.95000000000,5612.05000000000,5597.18000000000,5682.34000000000,5610.84000000000,5720.23000000000,5736.71000000000,5720.74000000000,5749.48000000000,5825.99000000000,5737.95000000000,5689.92000000000,5733.14000000000,5676.22000000000,5689.87000000000,5609.79000000000,5627.59000000000,5621.19000000000,5471.60000000000,5498.06000000000,5428.44000000000,5343.34000000000,5286.07000000000,5235.46000000000,5202.70000000000,5188.19000000000,5100.16000000000,5057.12000000000,5247.08000000000,5246.27000000000,5214.14000000000,5096.61000000000,5065.90000000000,5152.05000000000,5157.22000000000,5098.95000000000,5031.87000000000,4962.73000000000,4891.72000000000,4848.10000000000,4806.18000000000,4797.10000000000,4665.01000000000,4607.97000000000,4531.22000000000,4565.14000000000,4521.16000000000,4505.56000000000,4484.55000000000,4457.60000000000,4414.14000000000,4308.68000000000,4394.36000000000,4369.27000000000,4308.57000000000,4368.24000000000,4318.03000000000,4201.41000000000,4239.43000000000,4210.86000000000,4164.32000000000,4162.04000000000,4169.35000000000,4113.39000000000,4199.62000000000,4237.66000000000,4113.23000000000,4207.95000000000,4174.22000000000,4213.93000000000,4182.67000000000,4201.69000000000,4167.28000000000,4155.57000000000,4139.37000000000];


ScheduleGenerationMW_Forecast_N = [5654.75500000000,5654.75500000000,5654.75500000000,5654.75500000000,5654.75500000000,5654.75500000000,5351.76000000000,5351.76000000000,5351.76000000000,5351.76000000000,5351.76000000000,5351.76000000000,5221.28200000000,5221.28200000000,5221.28200000000,5221.28200000000,5221.28200000000,5221.28200000000,5033.32100000000,5033.32100000000,5033.32100000000,5033.32100000000,5033.32100000000,5033.32100000000,4905.91900000000,4905.91900000000,4905.91900000000,4905.91900000000,4905.91900000000,4905.91900000000,4721.76800000000,4721.76800000000,4721.76800000000,4721.76800000000,4721.76800000000,4721.76800000000,4661.76900000000,4661.76900000000,4661.76900000000,4661.76900000000,4661.76900000000,4661.76900000000,4626.77500000000,4626.77500000000,4626.77500000000,4626.77500000000,4626.77500000000,4626.77500000000,4626.76800000000,4626.76800000000,4626.76800000000,4626.76800000000,4626.76800000000,4626.76800000000,4781.77100000000,4781.77100000000,4781.77100000000,4781.77100000000,4781.77100000000,4781.77100000000,4811.77500000000,4811.77500000000,4811.77500000000,4811.77500000000,4811.77500000000,4811.77500000000,4736.89700000000,4736.89700000000,4736.89700000000,4736.89700000000,4736.89700000000,4736.89700000000,4831.90600000000,4831.90600000000,4831.90600000000,4831.90600000000,4831.90600000000,4831.90600000000,4921.76800000000,4921.76800000000,4921.76800000000,4921.76800000000,4921.76800000000,4921.76800000000,5041.77200000000,5041.77200000000,5041.77200000000,5041.77200000000,5041.77200000000,5041.77200000000,4951.76700000000,4951.76700000000,4951.76700000000,4951.76700000000,4951.76700000000,4951.76700000000,4419.76801000000,4419.76801000000,4419.76801000000,4419.76801000000,4419.76801000000,4419.76801000000,3946.77197000000,3946.77197000000,3946.77197000000,3946.77197000000,3946.77197000000,3946.77197000000,3871.77202000000,3871.77202000000,3871.77202000000,3871.77202000000,3871.77202000000,3871.77202000000,3731.76993000000,3731.76993000000,3731.76993000000,3731.76993000000,3731.76993000000,3731.76993000000,3731.77153000000,3731.77153000000,3731.77153000000,3731.77153000000,3731.77153000000,3731.77153000000,3731.77321000000,3731.77321000000,3731.77321000000,3731.77321000000,3731.77321000000,3731.77321000000,3731.77240000000,3731.77240000000,3731.77240000000,3731.77240000000,3731.77240000000,3731.77240000000,3731.76996000000,3731.76996000000,3731.76996000000,3731.76996000000,3731.76996000000,3731.76996000000,3731.76597000000];


SemiScheduleGenerationMW_Forecast_N = [145.995000000000,145.995000000000,145.995000000000,145.995000000000,145.995000000000,145.995000000000,150.070000000000,150.070000000000,150.070000000000,150.070000000000,150.070000000000,150.070000000000,151.848000000000,151.848000000000,151.848000000000,151.848000000000,151.848000000000,151.848000000000,155.069000000000,155.069000000000,155.069000000000,155.069000000000,155.069000000000,155.069000000000,158.141000000000,158.141000000000,158.141000000000,158.141000000000,158.141000000000,158.141000000000,159.562000000000,159.562000000000,159.562000000000,159.562000000000,159.562000000000,159.562000000000,159.111000000000,159.111000000000,159.111000000000,159.111000000000,159.111000000000,159.111000000000,158.705000000000,158.705000000000,158.705000000000,158.705000000000,158.705000000000,158.705000000000,156.792000000000,156.792000000000,156.792000000000,156.792000000000,156.792000000000,156.792000000000,163.939000000000,163.939000000000,163.939000000000,163.939000000000,163.939000000000,163.939000000000,173.065000000000,173.065000000000,173.065000000000,173.065000000000,173.065000000000,173.065000000000,184.783000000000,184.783000000000,184.783000000000,184.783000000000,184.783000000000,184.783000000000,194.354000000000,194.354000000000,194.354000000000,194.354000000000,194.354000000000,194.354000000000,204.982000000000,204.982000000000,204.982000000000,204.982000000000,204.982000000000,204.982000000000,323.818000000000,323.818000000000,323.818000000000,323.818000000000,323.818000000000,323.818000000000,943.213000000000,943.213000000000,943.213000000000,943.213000000000,943.213000000000,943.213000000000,1733.84199000000,1733.84199000000,1733.84199000000,1733.84199000000,1733.84199000000,1733.84199000000,2042.64803000000,2042.64803000000,2042.64803000000,2042.64803000000,2042.64803000000,2042.64803000000,1746.28798000000,1746.28798000000,1746.28798000000,1746.28798000000,1746.28798000000,1746.28798000000,1875.72007000000,1875.72007000000,1875.72007000000,1875.72007000000,1875.72007000000,1875.72007000000,1680.04847000000,1680.04847000000,1680.04847000000,1680.04847000000,1680.04847000000,1680.04847000000,1851.94679000000,1851.94679000000,1851.94679000000,1851.94679000000,1851.94679000000,1851.94679000000,1832.07760000000,1832.07760000000,1832.07760000000,1832.07760000000,1832.07760000000,1832.07760000000,1752.85004000000,1752.85004000000,1752.85004000000,1752.85004000000,1752.85004000000,1752.85004000000,1631.77403000000];


NetImportMW_Actual = [-102.200000000000,-2.86000000000000,3.95000000000000,-48.6200000000000,-75.3500000000000,-109.270000000000,-145.760000000000,-222.820000000000,-282.320000000000,-288.350000000000,-241.620000000000,-308.740000000000,-314.230000000000,-379.700000000000,-380.160000000000,-358.720000000000,-314.210000000000,-324.080000000000,-303.580000000000,-356.690000000000,-363.740000000000,-309.290000000000,-340.060000000000,-348.960000000000,-357.650000000000,-426.250000000000,-403.300000000000,-370.330000000000,-400.510000000000,-415.270000000000,-413.520000000000,-437.260000000000,-447.950000000000,-447.270000000000,-413.730000000000,-470.950000000000,-482.570000000000,-506.520000000000,-458.280000000000,-426.520000000000,-482.560000000000,-434.330000000000,-492.190000000000,-488.950000000000,-466.520000000000,-450.400000000000,-458.940000000000,-428.680000000000,-355.620000000000,-301.570000000000,-379.960000000000,-457.910000000000,-452.360000000000,-467.240000000000,-365.180000000000,-305.930000000000,-267.320000000000,-249.040000000000,-189.730000000000,-256.290000000000,-231.910000000000,-397.590000000000,-230.190000000000,-302.410000000000,-425.870000000000,-364.750000000000,-401.940000000000,-358.840000000000,-345.150000000000,-295.630000000000,-268.090000000000,-301.730000000000,-252.640000000000,-301.810000000000,-124.230000000000,-228.440000000000,-127.460000000000,-21.6500000000000,15.3900000000000,-35.3400000000000,46.9800000000000,189.990000000000,272.370000000000,239.090000000000,340.340000000000,341.220000000000,409.950000000000,468.040000000000,543.970000000000,563.800000000000,696.580000000000,651.330000000000,731.280000000000,664,689.290000000000,740.320000000000,736.100000000000,601.320000000000,578.780000000000,594.710000000000,578.720000000000,620.990000000000,831.480000000000,854.220000000000,816.360000000000,614,650.300000000000,689.070000000000,688.880000000000,736.180000000000,789.300000000000,826.470000000000,839.340000000000,859.070000000000,861.580000000000,811.800000000000,890.260000000000,871.440000000000,987.040000000000,992.750000000000,1015.33000000000,712.500000000000,741.890000000000,1037.54000000000,958.860000000000,946.830000000000,602.390000000000,611.590000000000,669.350000000000,674.860000000000,594.930000000000,615.900000000000,976.530000000000,970.370000000000,979.950000000000,951.660000000000,940.960000000000,888.620000000000,895.470000000000,856.820000000000,815.380000000000,773.620000000000,722.440000000000,736.360000000000,779.140000000000];


NetImportMWForecast_N = [-128.760000000000,-128.760000000000,-128.760000000000,-128.760000000000,-128.760000000000,-128.760000000000,-230.010000000000,-230.010000000000,-230.010000000000,-230.010000000000,-230.010000000000,-230.010000000000,-200.370000000000,-200.370000000000,-200.370000000000,-200.370000000000,-200.370000000000,-200.370000000000,-255.940000000000,-255.940000000000,-255.940000000000,-255.940000000000,-255.940000000000,-255.940000000000,-315.630000000000,-315.630000000000,-315.630000000000,-315.630000000000,-315.630000000000,-315.630000000000,-437.510000000000,-437.510000000000,-437.510000000000,-437.510000000000,-437.510000000000,-437.510000000000,-466.290000000000,-466.290000000000,-466.290000000000,-466.290000000000,-466.290000000000,-466.290000000000,-482.130000000000,-482.130000000000,-482.130000000000,-482.130000000000,-482.130000000000,-482.130000000000,-474.680000000000,-474.680000000000,-474.680000000000,-474.680000000000,-474.680000000000,-474.680000000000,-337.730000000000,-337.730000000000,-337.730000000000,-337.730000000000,-337.730000000000,-337.730000000000,-347.930000000000,-347.930000000000,-347.930000000000,-347.930000000000,-347.930000000000,-347.930000000000,-474.620000000000,-474.620000000000,-474.620000000000,-474.620000000000,-474.620000000000,-474.620000000000,-441.250000000000,-441.250000000000,-441.250000000000,-441.250000000000,-441.250000000000,-441.250000000000,-399.270000000000,-399.270000000000,-399.270000000000,-399.270000000000,-399.270000000000,-399.270000000000,-98.5900000000000,-98.5900000000000,-98.5900000000000,-98.5900000000000,-98.5900000000000,-98.5900000000000,558.360000000000,558.360000000000,558.360000000000,558.360000000000,558.360000000000,558.360000000000,1062.52000000000,1062.52000000000,1062.52000000000,1062.52000000000,1062.52000000000,1062.52000000000,1192.88000000000,1192.88000000000,1192.88000000000,1192.88000000000,1192.88000000000,1192.88000000000,1092.35000000000,1092.35000000000,1092.35000000000,1092.35000000000,1092.35000000000,1092.35000000000,1116.30000000000,1116.30000000000,1116.30000000000,1116.30000000000,1116.30000000000,1116.30000000000,914.360000000000,914.360000000000,914.360000000000,914.360000000000,914.360000000000,914.360000000000,1144.29000000000,1144.29000000000,1144.29000000000,1144.29000000000,1144.29000000000,1144.29000000000,1246.35000000000,1246.35000000000,1246.35000000000,1246.35000000000,1246.35000000000,1246.35000000000,1207.28000000000,1207.28000000000,1207.28000000000,1207.28000000000,1207.28000000000,1207.28000000000,1161.27000000000];


k = 6;
epsilon = 1e-10; % Small value to prevent division by zero
num_iterations = floor(length(ScheduledGenerationMW_Actual) / k); % Number of 6-value windows

% Initialize arrays to store Lambda and b values for all iterations
Lambda_values = zeros(1, num_iterations); % Preallocate for 1000 elements
b_values = zeros(1, num_iterations);      % Preallocate for 1000 elements

% Initialize final objective value
final_objective_value = 0;

for i = 1:num_iterations
    % Extract the current window of 6 values
    ScheduledGenerationMW_Actual_window = ScheduledGenerationMW_Actual((i-1)*k + 1:i*k);
    SemiScheduledGenerationMW_Actual_window = SemiScheduledGenerationMW_Actual((i-1)*k + 1:i*k);
    ScheduledDemandMW_Actual_window = ScheduledDemandMW_Actual((i-1)*k + 1:i*k);
    ScheduleGenerationMW_Forecast_N_window = ScheduleGenerationMW_Forecast_N((i-1)*k + 1:i*k);
    SemiScheduleGenerationMW_Forecast_N_window = SemiScheduleGenerationMW_Forecast_N((i-1)*k + 1:i*k);
    NetImportMW_Actual_window = NetImportMW_Actual((i-1)*k + 1:i*k);
    NetImportMWForecast_N_window = NetImportMWForecast_N((i-1)*k + 1:i*k);
    
    b = sdpvar(1, k, 'full');
    Lambda = sdpvar(1, k, 'full');
    constraints = [];
    objectiveFunction = 0;

    for m = 1:k
        if m == 1
            b(1,1) = 1; % Initial value
            Lambda(1,1) = 106.63; % Initial value for Lambda
        else
            Lambda(1,m) = Lambda(1,(m-1))*(1- (ScheduledGenerationMW_Actual_window(1,(m-1))+ SemiScheduledGenerationMW_Actual_window(1,(m-1))-ScheduledDemandMW_Actual_window(1,(m-1)))/(ScheduleGenerationMW_Forecast_N_window(1,(m-1))+SemiScheduleGenerationMW_Forecast_N_window(1,(m-1))-ScheduledDemandMW_Actual_window(1,(m-1)))+(b(1,(m-1))*NetImportMW_Actual_window(1,(m-1)))/(NetImportMWForecast_N_window(1,(m-1))));
            constraints = [constraints, ...
                ((ScheduledGenerationMW_Actual_window(1,m) + SemiScheduledGenerationMW_Actual_window(1,m) - ScheduledDemandMW_Actual_window(1,m) + (b(1,m)*NetImportMW_Actual_window(1,m)))) >= -180, ...
                ((ScheduledGenerationMW_Actual_window(1,m) + SemiScheduledGenerationMW_Actual_window(1,m) - ScheduledDemandMW_Actual_window(1,m) + (b(1,m)*NetImportMW_Actual_window(1,m)))) <= 180, ...
                Lambda(1,m)>=-800, ...
                Lambda(1,m)<=400, ...
                b(1,m) >=-2, ...
                b(1,m) <=2];
            objectiveFunction = objectiveFunction + Lambda(1,m)*b(1,m)*(NetImportMW_Actual_window(1,m));
              
        end
       
    end

    optimize(constraints, objectiveFunction, opts);
    
    % Store the computed values of Lambda and b in the arrays
    Lambda_values((i-1)*k + 1:i*k) = value(Lambda);
    b_values((i-1)*k + 1:i*k) = value(b);
    
    final_objective_value = final_objective_value + value(abs(objectiveFunction));
end


for i = 1:length(Lambda_values)
    if Lambda_values(1,i)>=600
        Lambda_values(1,i) =600;
    end
end

for j = 1:144
    if(Lambda_values(1,j)<=-20)
        Lambda_values(1,j)=-20;
    end
    Profit(1,j) = abs(Lambda_values(1,j)*b_values(1,j)*NetImportMW_Actual(1,j));
end


for j = 1:144
    fr(1,j) = 60+(ScheduledGenerationMW_Actual(1,j)+SemiScheduledGenerationMW_Actual(1,j)-ScheduledDemandMW_Actual(1,j)+b_values(1,j)*NetImportMW_Actual(1,j))/1800;
end


final_objective_value
%Lambda_values
%b_values
